partall â† { # all nontrivial partitions
  tbl â† 1âŠ¸â†“Â¨ (âˆ¾{ğ•©âŠ¸âˆ¾Â¨ â†•2+Â¯1âŒˆÂ´ğ•©}Â¨)âŸ(â†•7) âŸ¨âŸ¨âŸ©âŸ©
  {âŠ”âŸœğ•©Â¨(â‰ ğ•©)âŠ‘tbl}
}
Part2 â† {âŠ”âŸœğ•©Â¨Â¯1â†“â¥Šâˆ¾âŒœÂ´/âŸœâŸ¨â†•2âŸ©â‰ ğ•©} # all ordered two-partitions with nonempty first

I â† {(âŠ‘ğ•©)âˆ¾âˆ¾âˆ¾âŸœ(âŠ‘ğ•¨)Â¨1â†“ğ•©}  # intersperse positive
J â† {Â·ğ•Š"":"";(ğ•¨Iğ•©)âˆ¾1âŠ‘ğ•¨} # intersperse negative
  ! ("+-" I "abc") â‰¡ "ab+c+"
  ! ("+-" J "abc") â‰¡ "ab+c+-"
K â† IâŸœâŠ‘ âˆ¾ {ğ•¨ J 1âŠ‘ğ•©âˆ¾<âŸ¨âŸ©} # resolve both
  ! ("+-" K âŸ¨âŸ¨"ab*","c"âŸ©,âŸ¨"d", "ef/"âŸ©âŸ©) â‰¡ "ab*c+def/+-"


# Cartesian product of list of tuples
Prods â† {â¥ŠâŸ¨âŸ¨âŸ©âŸ©<âŠ¸âˆ¾âŒœÂ´ğ•©}

All â† {
  Â·ğ•ŠâŸ¨âŸ©:  !"cannot arrange nothing";
  Â·ğ•ŠâŸ¨aâŸ©: âŸ¨âŸ¨aâŸ©âŸ©;
  r â† (âŒ½ğ•¨)âŠ¸AllÂ¨Â¨ Partall ğ•©
  âˆ¾ (0âŠ‘ğ•¨)âŠ¸KÂ¨âˆ˜Part2Â¨ âˆ¾ProdsÂ¨ r
}

# â€¢OutÂ¨ âŸ¨"a","b","c","d","e","f"âŸ© # ones
# â€¢OutÂ¨ âˆ¾âŸ¨"+-","*/"âŸ©âŠ¸AllÂ¨ ({(1<+Â´Â¨)âŠ¸/ â¥Šâˆ¾âŒœÂ´/âŸœâŸ¨0â€¿1âŸ©â‰ ğ•©}/Â¨<) "abcdef"
# â€¢OutÂ¨ âˆ¾âŸ¨"*/","+-"âŸ©âŠ¸AllÂ¨ ({(1<+Â´Â¨)âŠ¸/ â¥Šâˆ¾âŒœÂ´/âŸœâŸ¨0â€¿1âŸ©â‰ ğ•©}/Â¨<) "abcdef"



ToInst â† {
  Step â† {in ğ•Š âŸ¨stack, inst, topâŸ©: {
    âŠ‘inâˆŠ"abcdef"? âŸ¨(1+in-'a')âˆ¾stack, inst, topâŸ©;
    âŸ¨rhs,lhsâŸ© â† 2â†‘stack
    âŸ¨topâˆ¾2â†“stack, instâˆ¾âŸ¨âŸ¨lhs,rhs,inâŸ©âŸ©, top+1âŸ©
  }}
  âŸ¨âŸ¨resâŸ©, inst, topâŸ© â† âŸ¨âŸ¨âŸ©,âŸ¨âŸ©,7âŸ© StepÂ´ âŒ½ğ•©
  nop â† âŸ¨0, res, '+'âŸ©
  inst âˆ¾ (5-â‰ inst)/âŸ¨nopâŸ©
}

ToC â† { âŸ¨lhs, rhs, opâŸ©:
  op â†© âŸ¨"Add","Sub","Mul","Div"âŸ©âŠ‘ËœâŠ‘"+-*/"âŠop
  "{ .lhs="âˆ¾(â€¢Fmt lhs)âˆ¾", .rhs="âˆ¾(â€¢Fmt rhs)âˆ¾", .op="âˆ¾opâˆ¾"},
"
}



ones â† âŸ¨"a","b","c","d","e","f"âŸ©
adds â† âˆ¾âŸ¨"+-","*/"âŸ©âŠ¸AllÂ¨ ({(1<+Â´Â¨)âŠ¸/ â¥Šâˆ¾âŒœÂ´/âŸœâŸ¨0â€¿1âŸ©â‰ ğ•©}/Â¨<) "abcdef"
muls â† âˆ¾âŸ¨"*/","+-"âŸ©âŠ¸AllÂ¨ ({(1<+Â´Â¨)âŠ¸/ â¥Šâˆ¾âŒœÂ´/âŸœâŸ¨0â€¿1âŸ©â‰ ğ•©}/Â¨<) "abcdef"
count â† (â‰ ones) + (â‰ adds) + (â‰ muls)

â€¢Out "
#include ""compute.h""

int computations_count = "âˆ¾(â€¢Fmt count)âˆ¾";
struct Instruction computations[] = {
"
  {â€¢Outâˆ¾Â´ToCÂ¨ToInstğ•©}Â¨ ones
  {â€¢Outâˆ¾Â´ToCÂ¨ToInstğ•©}Â¨ adds
  {â€¢Outâˆ¾Â´ToCÂ¨ToInstğ•©}Â¨ muls
â€¢Out "};"



# ToBinary â† {âŸ¨lhs,rhs,opâŸ©:âŸ¨lhs+rhsÃ—16,âŠ‘"+-*/"âŠopâŸ©}
# "web/computations.bin" â€¢FBytes âˆ¾ToBinaryÂ¨âˆ¾ToInstÂ¨(onesâˆ¾addsâˆ¾muls)
